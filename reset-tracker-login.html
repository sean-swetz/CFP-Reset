<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Reset 2026 Challenge Tracker</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 800px;
            margin: 0 auto;
        }

        .header {
            background: white;
            border-radius: 20px;
            padding: 30px;
            text-align: center;
            margin-bottom: 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
        }

        h1 {
            color: #4facfe;
            font-size: 2.5em;
            margin-bottom: 10px;
        }

        .subtitle {
            color: #7ed957;
            font-size: 1.2em;
            font-weight: 600;
        }

        .card {
            background: white;
            border-radius: 20px;
            padding: 30px;
            margin-bottom: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
        }

        h2 {
            color: #4facfe;
            margin-bottom: 20px;
            font-size: 1.8em;
        }

        .form-group {
            margin-bottom: 20px;
        }

        label {
            display: block;
            color: #333;
            font-weight: 600;
            margin-bottom: 8px;
            font-size: 1.1em;
        }

        input[type="text"],
        input[type="email"],
        input[type="password"] {
            width: 100%;
            padding: 12px;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            font-size: 1em;
            transition: border-color 0.3s;
        }

        input[type="text"]:focus,
        input[type="email"]:focus,
        input[type="password"]:focus {
            outline: none;
            border-color: #4facfe;
        }

        .challenge-item {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 15px;
        }

        .challenge-header {
            margin-bottom: 12px;
        }

        .challenge-name {
            font-weight: 600;
            color: #333;
            display: block;
            margin-bottom: 5px;
        }

        .challenge-points {
            color: #7ed957;
            font-weight: 700;
            font-size: 0.9em;
        }

        .days-grid {
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
        }

        .day-checkbox {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 5px;
        }

        .day-checkbox label {
            font-size: 0.85em;
            font-weight: 600;
            color: #666;
            margin: 0;
        }

        .day-checkbox input[type="checkbox"] {
            width: 24px;
            height: 24px;
            cursor: pointer;
            accent-color: #7ed957;
        }

        .single-checkbox {
            display: flex;
            align-items: center;
            gap: 10px;
            cursor: pointer;
        }

        .single-checkbox input[type="checkbox"] {
            width: 24px;
            height: 24px;
            cursor: pointer;
            accent-color: #7ed957;
        }

        .single-checkbox.deduction input[type="checkbox"] {
            accent-color: #ff6b6b;
        }

        .single-checkbox label {
            margin: 0;
            cursor: pointer;
            font-weight: 500;
        }

        .deduction-item {
            background: #fff3f3;
            border-left: 4px solid #ff6b6b;
        }

        .deduction-points {
            color: #ff6b6b;
        }

        .btn {
            background: linear-gradient(135deg, #7ed957 0%, #5cb85c 100%);
            color: white;
            border: none;
            padding: 15px 40px;
            border-radius: 10px;
            font-size: 1.1em;
            font-weight: 600;
            cursor: pointer;
            width: 100%;
            transition: transform 0.2s, box-shadow 0.2s;
            margin-top: 10px;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 20px rgba(126, 217, 87, 0.4);
        }

        .btn-secondary {
            background: linear-gradient(135deg, #4facfe 0%, #3d8fd1 100%);
        }

        .btn-secondary:hover {
            box-shadow: 0 5px 20px rgba(79, 172, 254, 0.4);
        }

        .total-score {
            background: linear-gradient(135deg, #7ed957 0%, #5cb85c 100%);
            color: white;
            padding: 20px;
            border-radius: 10px;
            text-align: center;
            margin-top: 20px;
            font-size: 1.5em;
            font-weight: 700;
        }

        .leaderboard-table {
            width: 100%;
            border-collapse: collapse;
        }

        .leaderboard-table th {
            background: linear-gradient(135deg, #4facfe 0%, #3d8fd1 100%);
            color: white;
            padding: 15px;
            text-align: left;
            font-weight: 600;
        }

        .leaderboard-table td {
            padding: 15px;
            border-bottom: 1px solid #e0e0e0;
        }

        .leaderboard-table tr:hover {
            background: #f8f9fa;
        }

        .rank {
            font-weight: 700;
            font-size: 1.2em;
            color: #4facfe;
        }

        .rank-1 { color: #FFD700; }
        .rank-2 { color: #C0C0C0; }
        .rank-3 { color: #CD7F32; }

        .section {
            display: none;
        }

        .section.active {
            display: block;
        }

        .nav-buttons {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }

        .nav-btn {
            flex: 1;
            padding: 12px;
            background: white;
            border: 2px solid #4facfe;
            color: #4facfe;
            border-radius: 10px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s;
        }

        .nav-btn.active {
            background: #4facfe;
            color: white;
        }

        .success-message {
            background: #d4edda;
            color: #155724;
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 20px;
            display: none;
        }

        .error-message {
            background: #f8d7da;
            color: #721c24;
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 20px;
            display: none;
        }

        /* Auth Pages */
        .login-container {
            max-width: 450px;
            margin: 50px auto;
        }

        .auth-tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }

        .auth-tab {
            flex: 1;
            padding: 12px;
            background: white;
            border: 2px solid #4facfe;
            color: #4facfe;
            border-radius: 10px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s;
            text-align: center;
        }

        .auth-tab.active {
            background: #4facfe;
            color: white;
        }

        .auth-form {
            display: none;
        }

        .auth-form.active {
            display: block;
        }

        .logged-in-user {
            background: linear-gradient(135deg, #7ed957 0%, #5cb85c 100%);
            color: white;
            padding: 15px 20px;
            border-radius: 10px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .logout-btn {
            background: white;
            color: #5cb85c;
            border: none;
            padding: 8px 20px;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
        }

        #app {
            display: none;
        }

        #app.active {
            display: block;
        }

        #authPage {
            display: block;
        }

        #authPage.hidden {
            display: none;
        }

        @media (max-width: 600px) {
            h1 {
                font-size: 1.8em;
            }
            
            .challenge-item {
                gap: 15px;
            }
            
            .days-grid {
                width: 100%;
                justify-content: space-between;
            }

            .day-checkbox {
                flex: 1;
                min-width: 40px;
            }
        }
    </style>
</head>
<body>
    <!-- Authentication Page -->
    <div id="authPage">
        <div class="login-container">
            <div class="header">
                <h1>RESET 2026</h1>
                <p class="subtitle">Nutrition & Fitness Challenge</p>
            </div>

            <div class="card">
                <div class="auth-tabs">
                    <div class="auth-tab active" onclick="showAuthTab('login')">Login</div>
                    <div class="auth-tab" onclick="showAuthTab('register')">Register</div>
                </div>

                <div class="error-message" id="authError"></div>
                <div class="success-message" id="authSuccess"></div>

                <!-- Login Form -->
                <form id="loginForm" class="auth-form active">
                    <h2>Welcome Back!</h2>
                    <div class="form-group">
                        <label>Email Address</label>
                        <input type="email" id="loginEmail" required>
                    </div>
                    <div class="form-group">
                        <label>Password</label>
                        <input type="password" id="loginPassword" required>
                    </div>
                    <button type="submit" class="btn">Login</button>
                </form>

                <!-- Register Form -->
                <form id="registerForm" class="auth-form">
                    <h2>Join the Challenge</h2>
                    <div class="form-group">
                        <label>Full Name</label>
                        <input type="text" id="regName" required>
                    </div>
                    <div class="form-group">
                        <label>Email Address</label>
                        <input type="email" id="regEmail" required>
                    </div>
                    <div class="form-group">
                        <label>Password</label>
                        <input type="password" id="regPassword" required minlength="6">
                    </div>
                    <button type="submit" class="btn">Create Account</button>
                </form>
            </div>
        </div>
    </div>

    <!-- Main App (hidden until logged in) -->
    <div id="app" class="container">
        <div class="header">
            <h1>RESET 2026</h1>
            <p class="subtitle">Nutrition & Fitness Challenge Tracker</p>
        </div>

        <div class="logged-in-user">
            <span id="userGreeting">Welcome!</span>
            <button class="logout-btn" onclick="logout()">Logout</button>
        </div>

        <div class="nav-buttons">
            <button class="nav-btn active" onclick="showSection('checkin')">Check In</button>
            <button class="nav-btn" onclick="showSection('leaderboard')">Leaderboard</button>
        </div>

        <!-- Check In Section -->
        <div id="checkin" class="section active">
            <div class="card">
                <h2>Weekly Check-In</h2>
                <div class="success-message" id="checkinSuccess"></div>
                <form id="checkinForm">
                    <h3 style="color: #7ed957; margin: 30px 0 15px 0;">üí™ Earn Points</h3>
                    
                    <div class="challenge-item">
                        <div class="challenge-header">
                            <span class="challenge-name">Hit Protein Goal</span>
                            <span class="challenge-points">+5 pts/day</span>
                        </div>
                        <div class="days-grid">
                            <div class="day-checkbox">
                                <input type="checkbox" id="protein_mon" class="protein-check">
                                <label>Mon</label>
                            </div>
                            <div class="day-checkbox">
                                <input type="checkbox" id="protein_tue" class="protein-check">
                                <label>Tue</label>
                            </div>
                            <div class="day-checkbox">
                                <input type="checkbox" id="protein_wed" class="protein-check">
                                <label>Wed</label>
                            </div>
                            <div class="day-checkbox">
                                <input type="checkbox" id="protein_thu" class="protein-check">
                                <label>Thu</label>
                            </div>
                            <div class="day-checkbox">
                                <input type="checkbox" id="protein_fri" class="protein-check">
                                <label>Fri</label>
                            </div>
                            <div class="day-checkbox">
                                <input type="checkbox" id="protein_sat" class="protein-check">
                                <label>Sat</label>
                            </div>
                            <div class="day-checkbox">
                                <input type="checkbox" id="protein_sun" class="protein-check">
                                <label>Sun</label>
                            </div>
                        </div>
                    </div>

                    <div class="challenge-item">
                        <div class="challenge-header">
                            <span class="challenge-name">Hit Water Goal</span>
                            <span class="challenge-points">+5 pts/day</span>
                        </div>
                        <div class="days-grid">
                            <div class="day-checkbox">
                                <input type="checkbox" id="water_mon" class="water-check">
                                <label>Mon</label>
                            </div>
                            <div class="day-checkbox">
                                <input type="checkbox" id="water_tue" class="water-check">
                                <label>Tue</label>
                            </div>
                            <div class="day-checkbox">
                                <input type="checkbox" id="water_wed" class="water-check">
                                <label>Wed</label>
                            </div>
                            <div class="day-checkbox">
                                <input type="checkbox" id="water_thu" class="water-check">
                                <label>Thu</label>
                            </div>
                            <div class="day-checkbox">
                                <input type="checkbox" id="water_fri" class="water-check">
                                <label>Fri</label>
                            </div>
                            <div class="day-checkbox">
                                <input type="checkbox" id="water_sat" class="water-check">
                                <label>Sat</label>
                            </div>
                            <div class="day-checkbox">
                                <input type="checkbox" id="water_sun" class="water-check">
                                <label>Sun</label>
                            </div>
                        </div>
                    </div>

                    <div class="challenge-item">
                        <div class="challenge-header">
                            <span class="challenge-name">Attended 3+ Classes This Week</span>
                            <span class="challenge-points">+15 pts</span>
                        </div>
                        <div class="single-checkbox">
                            <input type="checkbox" id="classes">
                            <label for="classes">Completed</label>
                        </div>
                    </div>

                    <div class="challenge-item">
                        <div class="challenge-header">
                            <span class="challenge-name">Stretching/Yoga/Recovery</span>
                            <span class="challenge-points">+3 pts/day</span>
                        </div>
                        <div class="days-grid">
                            <div class="day-checkbox">
                                <input type="checkbox" id="recovery_mon" class="recovery-check">
                                <label>Mon</label>
                            </div>
                            <div class="day-checkbox">
                                <input type="checkbox" id="recovery_tue" class="recovery-check">
                                <label>Tue</label>
                            </div>
                            <div class="day-checkbox">
                                <input type="checkbox" id="recovery_wed" class="recovery-check">
                                <label>Wed</label>
                            </div>
                            <div class="day-checkbox">
                                <input type="checkbox" id="recovery_thu" class="recovery-check">
                                <label>Thu</label>
                            </div>
                            <div class="day-checkbox">
                                <input type="checkbox" id="recovery_fri" class="recovery-check">
                                <label>Fri</label>
                            </div>
                            <div class="day-checkbox">
                                <input type="checkbox" id="recovery_sat" class="recovery-check">
                                <label>Sat</label>
                            </div>
                            <div class="day-checkbox">
                                <input type="checkbox" id="recovery_sun" class="recovery-check">
                                <label>Sun</label>
                            </div>
                        </div>
                    </div>

                    <div class="challenge-item">
                        <div class="challenge-header">
                            <span class="challenge-name">Completed Weekly Challenge</span>
                            <span class="challenge-points">+20 pts</span>
                        </div>
                        <div class="single-checkbox">
                            <input type="checkbox" id="weekly">
                            <label for="weekly">Completed</label>
                        </div>
                    </div>

                    <h3 style="color: #ff6b6b; margin: 30px 0 15px 0;">‚ö†Ô∏è Deductions</h3>

                    <div class="challenge-item deduction-item">
                        <div class="challenge-header">
                            <span class="challenge-name">Consumed Alcohol</span>
                            <span class="challenge-points deduction-points">-5 pts/day</span>
                        </div>
                        <div class="days-grid">
                            <div class="day-checkbox">
                                <input type="checkbox" id="alcohol_mon" class="alcohol-check">
                                <label>Mon</label>
                            </div>
                            <div class="day-checkbox">
                                <input type="checkbox" id="alcohol_tue" class="alcohol-check">
                                <label>Tue</label>
                            </div>
                            <div class="day-checkbox">
                                <input type="checkbox" id="alcohol_wed" class="alcohol-check">
                                <label>Wed</label>
                            </div>
                            <div class="day-checkbox">
                                <input type="checkbox" id="alcohol_thu" class="alcohol-check">
                                <label>Thu</label>
                            </div>
                            <div class="day-checkbox">
                                <input type="checkbox" id="alcohol_fri" class="alcohol-check">
                                <label>Fri</label>
                            </div>
                            <div class="day-checkbox">
                                <input type="checkbox" id="alcohol_sat" class="alcohol-check">
                                <label>Sat</label>
                            </div>
                            <div class="day-checkbox">
                                <input type="checkbox" id="alcohol_sun" class="alcohol-check">
                                <label>Sun</label>
                            </div>
                        </div>
                    </div>

                    <div class="challenge-item deduction-item">
                        <div class="challenge-header">
                            <span class="challenge-name">Late to Class</span>
                            <span class="challenge-points deduction-points">-3 pts/occurrence</span>
                        </div>
                        <div class="days-grid">
                            <div class="day-checkbox">
                                <input type="checkbox" id="late_mon" class="late-check">
                                <label>Mon</label>
                            </div>
                            <div class="day-checkbox">
                                <input type="checkbox" id="late_tue" class="late-check">
                                <label>Tue</label>
                            </div>
                            <div class="day-checkbox">
                                <input type="checkbox" id="late_wed" class="late-check">
                                <label>Wed</label>
                            </div>
                            <div class="day-checkbox">
                                <input type="checkbox" id="late_thu" class="late-check">
                                <label>Thu</label>
                            </div>
                            <div class="day-checkbox">
                                <input type="checkbox" id="late_fri" class="late-check">
                                <label>Fri</label>
                            </div>
                            <div class="day-checkbox">
                                <input type="checkbox" id="late_sat" class="late-check">
                                <label>Sat</label>
                            </div>
                            <div class="day-checkbox">
                                <input type="checkbox" id="late_sun" class="late-check">
                                <label>Sun</label>
                            </div>
                        </div>
                    </div>

                    <div class="challenge-item deduction-item">
                        <div class="challenge-header">
                            <span class="challenge-name">Missed Weekly Check-In</span>
                            <span class="challenge-points deduction-points">-10 pts</span>
                        </div>
                        <div class="single-checkbox deduction">
                            <input type="checkbox" id="missed">
                            <label for="missed">Yes, I missed last week</label>
                        </div>
                    </div>

                    <div class="total-score" id="totalScore">
                        Total Weekly Score: 0 points
                    </div>

                    <button type="submit" class="btn">Submit Check-In</button>
                </form>
            </div>
        </div>

        <!-- Leaderboard Section -->
        <div id="leaderboard" class="section">
            <div class="card">
                <h2>üèÜ Leaderboard</h2>
                <table class="leaderboard-table">
                    <thead>
                        <tr>
                            <th>Rank</th>
                            <th>Name</th>
                            <th>Total Points</th>
                        </tr>
                    </thead>
                    <tbody id="leaderboardBody">
                        <!-- Leaderboard will be populated here -->
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <script>
        // Current user session
        let currentUser = null;

        // Check if user is already logged in
        function checkLoginStatus() {
            const storedUser = localStorage.getItem('currentUser');
            if (storedUser) {
                currentUser = JSON.parse(storedUser);
                showApp();
            }
        }

        // Show/hide pages
        function showApp() {
            document.getElementById('authPage').classList.add('hidden');
            document.getElementById('app').classList.add('active');
            document.getElementById('userGreeting').textContent = `Welcome, ${currentUser.name}!`;
            loadLeaderboard();
        }

        function showAuthPage() {
            document.getElementById('authPage').classList.remove('hidden');
            document.getElementById('app').classList.remove('active');
            currentUser = null;
        }

        // Auth tab switching
        function showAuthTab(tab) {
            document.querySelectorAll('.auth-tab').forEach(t => t.classList.remove('active'));
            document.querySelectorAll('.auth-form').forEach(f => f.classList.remove('active'));
            
            if (tab === 'login') {
                document.querySelectorAll('.auth-tab')[0].classList.add('active');
                document.getElementById('loginForm').classList.add('active');
            } else {
                document.querySelectorAll('.auth-tab')[1].classList.add('active');
                document.getElementById('registerForm').classList.add('active');
            }

            hideMessages();
        }

        function hideMessages() {
            document.getElementById('authError').style.display = 'none';
            document.getElementById('authSuccess').style.display = 'none';
        }

        function showAuthError(message) {
            const errorDiv = document.getElementById('authError');
            errorDiv.textContent = message;
            errorDiv.style.display = 'block';
            setTimeout(() => errorDiv.style.display = 'none', 5000);
        }

        function showAuthSuccess(message) {
            const successDiv = document.getElementById('authSuccess');
            successDiv.textContent = message;
            successDiv.style.display = 'block';
            setTimeout(() => successDiv.style.display = 'none', 5000);
        }

        // Registration
        document.getElementById('registerForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            hideMessages();
            
            const name = document.getElementById('regName').value;
            const email = document.getElementById('regEmail').value.toLowerCase();
            const password = document.getElementById('regPassword').value;

            try {
                if (window.storage) {
                    // Check if email already exists
                    const members = await window.storage.list('member_', true);
                    if (members && members.keys) {
                        for (const key of members.keys) {
                            try {
                                const result = await window.storage.get(key, true);
                                const member = JSON.parse(result.value);
                                if (member.email.toLowerCase() === email) {
                                    showAuthError('This email is already registered. Please login instead.');
                                    return;
                                }
                            } catch (err) {
                                console.error('Error checking member:', err);
                            }
                        }
                    }

                    const memberId = 'member_' + Date.now();
                    await window.storage.set(memberId, JSON.stringify({
                        id: memberId,
                        name: name,
                        email: email,
                        password: password,
                        totalPoints: 0,
                        registeredAt: new Date().toISOString()
                    }), true);

                    showAuthSuccess('Account created successfully! You can now login.');
                    document.getElementById('registerForm').reset();
                    setTimeout(() => showAuthTab('login'), 2000);
                } else {
                    // Fallback to localStorage
                    const users = JSON.parse(localStorage.getItem('users') || '{}');
                    if (users[email]) {
                        showAuthError('This email is already registered. Please login instead.');
                        return;
                    }

                    const memberId = 'member_' + Date.now();
                    users[email] = {
                        id: memberId,
                        name: name,
                        email: email,
                        password: password,
                        totalPoints: 0,
                        registeredAt: new Date().toISOString()
                    };
                    localStorage.setItem('users', JSON.stringify(users));

                    showAuthSuccess('Account created successfully! You can now login.');
                    document.getElementById('registerForm').reset();
                    setTimeout(() => showAuthTab('login'), 2000);
                }
            } catch (error) {
                console.error('Registration error:', error);
                showAuthError('Registration failed. Please try again.');
            }
        });

        // Login
        document.getElementById('loginForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            hideMessages();
            
            const email = document.getElementById('loginEmail').value.toLowerCase();
            const password = document.getElementById('loginPassword').value;

            try {
                if (window.storage) {
                    const members = await window.storage.list('member_', true);
                    let found = false;

                    if (members && members.keys) {
                        for (const key of members.keys) {
                            try {
                                const result = await window.storage.get(key, true);
                                const member = JSON.parse(result.value);
                                if (member.email.toLowerCase() === email && member.password === password) {
                                    currentUser = member;
                                    localStorage.setItem('currentUser', JSON.stringify(member));
                                    showApp();
                                    found = true;
                                    break;
                                }
                            } catch (err) {
                                console.error('Error checking credentials:', err);
                            }
                        }
                    }

                    if (!found) {
                        showAuthError('Invalid email or password.');
                    }
                } else {
                    // Fallback to localStorage
                    const users = JSON.parse(localStorage.getItem('users') || '{}');
                    const user = users[email];

                    if (user && user.password === password) {
                        currentUser = user;
                        localStorage.setItem('currentUser', JSON.stringify(user));
                        showApp();
                    } else {
                        showAuthError('Invalid email or password.');
                    }
                }
            } catch (error) {
                console.error('Login error:', error);
                showAuthError('Login failed. Please try again.');
            }
        });

        // Logout
        function logout() {
            localStorage.removeItem('currentUser');
            currentUser = null;
            showAuthPage();
            document.getElementById('loginForm').reset();
        }

        // Navigation
        function showSection(sectionName) {
            document.querySelectorAll('.section').forEach(s => s.classList.remove('active'));
            document.querySelectorAll('.nav-btn').forEach(b => b.classList.remove('active'));
            
            document.getElementById(sectionName).classList.add('active');
            event.target.classList.add('active');

            if (sectionName === 'leaderboard') {
                loadLeaderboard();
            }
        }

        // Calculate total score in real-time
        function updateTotalScore() {
            const protein = document.querySelectorAll('.protein-check:checked').length;
            const water = document.querySelectorAll('.water-check:checked').length;
            const classes = document.getElementById('classes').checked ? 1 : 0;
            const recovery = document.querySelectorAll('.recovery-check:checked').length;
            const weekly = document.getElementById('weekly').checked ? 1 : 0;
            const alcohol = document.querySelectorAll('.alcohol-check:checked').length;
            const late = document.querySelectorAll('.late-check:checked').length;
            const missed = document.getElementById('missed').checked ? 1 : 0;

            const total = (protein * 5) + (water * 5) + (classes * 15) + 
                         (recovery * 3) + (weekly * 20) - (alcohol * 5) - 
                         (late * 3) - (missed * 10);

            document.getElementById('totalScore').textContent = 
                `Total Weekly Score: ${total} points`;
        }

        // Add listeners to all checkboxes
        document.querySelectorAll('input[type="checkbox"]').forEach(checkbox => {
            checkbox.addEventListener('change', updateTotalScore);
        });

        // Check-in Form
        document.getElementById('checkinForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            if (!currentUser) {
                alert('Please login first');
                return;
            }

            const protein = document.querySelectorAll('.protein-check:checked').length;
            const water = document.querySelectorAll('.water-check:checked').length;
            const classes = document.getElementById('classes').checked ? 1 : 0;
            const recovery = document.querySelectorAll('.recovery-check:checked').length;
            const weekly = document.getElementById('weekly').checked ? 1 : 0;
            const alcohol = document.querySelectorAll('.alcohol-check:checked').length;
            const late = document.querySelectorAll('.late-check:checked').length;
            const missed = document.getElementById('missed').checked ? 1 : 0;

            const weeklyScore = (protein * 5) + (water * 5) + (classes * 15) + 
                               (recovery * 3) + (weekly * 20) - (alcohol * 5) - 
                               (late * 3) - (missed * 10);

            try {
                if (window.storage) {
                    const result = await window.storage.get(currentUser.id, true);
                    const member = JSON.parse(result.value);
                    const newTotal = (member.totalPoints || 0) + weeklyScore;

                    await window.storage.set(currentUser.id, JSON.stringify({
                        ...member,
                        totalPoints: newTotal,
                        lastCheckin: new Date().toISOString()
                    }), true);

                    // Store weekly log
                    const logKey = 'log_' + Date.now();
                    await window.storage.set(logKey, JSON.stringify({
                        userId: currentUser.id,
                        name: currentUser.name,
                        email: currentUser.email,
                        weeklyScore: weeklyScore,
                        details: { protein, water, classes, recovery, weekly, alcohol, late, missed },
                        timestamp: new Date().toISOString()
                    }), true);

                    currentUser.totalPoints = newTotal;
                    localStorage.setItem('currentUser', JSON.stringify(currentUser));
                } else {
                    // Fallback to localStorage
                    const users = JSON.parse(localStorage.getItem('users') || '{}');
                    const user = users[currentUser.email];
                    const newTotal = (user.totalPoints || 0) + weeklyScore;
                    user.totalPoints = newTotal;
                    user.lastCheckin = new Date().toISOString();
                    users[currentUser.email] = user;
                    localStorage.setItem('users', JSON.stringify(users));

                    currentUser.totalPoints = newTotal;
                    localStorage.setItem('currentUser', JSON.stringify(currentUser));
                }

                const successMsg = document.getElementById('checkinSuccess');
                successMsg.textContent = `Check-in submitted! You earned ${weeklyScore} points this week. Your total is now ${currentUser.totalPoints} points.`;
                successMsg.style.display = 'block';
                
                document.getElementById('checkinForm').reset();
                updateTotalScore();

                setTimeout(() => {
                    successMsg.style.display = 'none';
                }, 5000);

            } catch (error) {
                console.error('Check-in error:', error);
                alert(`Check-in recorded! Weekly score: ${weeklyScore} points`);
                document.getElementById('checkinForm').reset();
                updateTotalScore();
            }
        });

        // Load Leaderboard
        async function loadLeaderboard() {
            const tbody = document.getElementById('leaderboardBody');
            
            try {
                if (window.storage) {
                    const members = await window.storage.list('member_', true);
                    const leaderboardData = [];

                    if (members && members.keys) {
                        for (const key of members.keys) {
                            try {
                                const result = await window.storage.get(key, true);
                                const member = JSON.parse(result.value);
                                leaderboardData.push(member);
                            } catch (err) {
                                console.error('Error reading member:', err);
                            }
                        }
                    }

                    leaderboardData.sort((a, b) => (b.totalPoints || 0) - (a.totalPoints || 0));

                    tbody.innerHTML = '';
                    leaderboardData.forEach((member, index) => {
                        const row = tbody.insertRow();
                        const rankClass = index < 3 ? `rank-${index + 1}` : '';
                        const isCurrentUser = currentUser && member.email === currentUser.email;
                        row.style.background = isCurrentUser ? '#e8f5e9' : '';
                        row.innerHTML = `
                            <td><span class="rank ${rankClass}">${index + 1}</span></td>
                            <td>${member.name}${isCurrentUser ? ' (You)' : ''}</td>
                            <td><strong>${member.totalPoints || 0} pts</strong></td>
                        `;
                    });

                    if (leaderboardData.length === 0) {
                        tbody.innerHTML = '<tr><td colspan="3" style="text-align: center; padding: 30px; color: #999;">No check-ins yet. Be the first!</td></tr>';
                    }
                } else {
                    // Fallback to localStorage
                    const users = JSON.parse(localStorage.getItem('users') || '{}');
                    const leaderboardData = Object.values(users);
                    leaderboardData.sort((a, b) => (b.totalPoints || 0) - (a.totalPoints || 0));

                    tbody.innerHTML = '';
                    leaderboardData.forEach((member, index) => {
                        const row = tbody.insertRow();
                        const rankClass = index < 3 ? `rank-${index + 1}` : '';
                        const isCurrentUser = currentUser && member.email === currentUser.email;
                        row.style.background = isCurrentUser ? '#e8f5e9' : '';
                        row.innerHTML = `
                            <td><span class="rank ${rankClass}">${index + 1}</span></td>
                            <td>${member.name}${isCurrentUser ? ' (You)' : ''}</td>
                            <td><strong>${member.totalPoints || 0} pts</strong></td>
                        `;
                    });

                    if (leaderboardData.length === 0) {
                        tbody.innerHTML = '<tr><td colspan="3" style="text-align: center; padding: 30px; color: #999;">No check-ins yet. Be the first!</td></tr>';
                    }
                }
            } catch (error) {
                console.error('Leaderboard error:', error);
                tbody.innerHTML = '<tr><td colspan="3" style="text-align: center; padding: 30px;">Error loading leaderboard</td></tr>';
            }
        }

        // Initialize
        updateTotalScore();
        checkLoginStatus();
    </script>
</body>
</html>
